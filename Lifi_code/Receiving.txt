// Define the analog pin for sensor reading and initial variables
#define SENSOR_PIN A0
#define NUM_SAMPLES 10  // Number of samples to average for initial threshold

int sensorThreshold = 0; // Variable to store the computed threshold

void setup() {
  // Initialize serial communication
  Serial.begin(9600);
  
  // Initialize sensor pin as input
  pinMode(SENSOR_PIN, INPUT);
  
  // Compute initial threshold as an average of sensor readings
  for (int i = 0; i < NUM_SAMPLES; i++) {
    sensorThreshold += analogRead(SENSOR_PIN);
    delay(10);
  }
  sensorThreshold /= NUM_SAMPLES;
  
  // Print the initial threshold value
  Serial.print("Initial Sensor Threshold: ");
  Serial.println(sensorThreshold);
  
  // Call the setup function from the second code
  setupSecondCode();
}

void loop() {
  // Call the loop function from the second code
  loopSecondCode();
}

// Second code snippet begins here

#define SOLARPIN A0

int ambientReading = 0;

void setupSecondCode() {
  pinMode(SOLARPIN, INPUT);
}

void loopSecondCode() {
  int reading = analogRead(SOLARPIN);

  int bits[8];

  // Listening for the start bit
  if (reading > sensorThreshold) {
    for (int i = 0; i < 8; i++) {
      if (analogRead(SOLARPIN) > sensorThreshold) {
        bits[i] = 1;
      }
      else {
        bits[i] = 0;
      }
      delay(10);
    }

    int m = 0;
    for (int j = 1; j < 8; j++) {
      if (bits[j] == 1) {
        m = m + (1 << (7 - j));
      }
    }
  
    char n = m;
    Serial.print(n);
  }
}